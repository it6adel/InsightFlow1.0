# InsightFlow: COD E-commerce BI Dashboard & Narrative Chatbot

InsightFlow is a Business Intelligence (BI) platform designed for Cash-on-Delivery (COD) e-commerce businesses, specifically focusing on PC gaming accessories in the North African region. It combines an interactive sales performance dashboard built with Apache Superset and an AI-powered chatbot (using Flask and Google Gemini API) to provide accessible, dynamic, and narrative data insights.

This project aims to help users, even those with limited technical expertise, to easily understand key performance indicators (KPIs), track sales and operational trends, identify challenges specific to the COD model (like high failure rates), and make data-driven decisions.

## Features

*   **Interactive Superset Dashboard:** Visualizes key metrics such as delivered revenue, gross profit, order status distributions, sales funnels, top-performing products & categories, cancellation reason breakdowns, and geographic performance.
*   **AI-Powered Chatbot:**
    *   Allows users to ask questions in natural language about the dashboard data and beyond.
    *   Provides narrative explanations and summaries generated by Google Gemini.
    *   Can answer questions about specific KPIs, explain trends, compare data points, identify anomalies, suggest solutions for problem areas, and define common business terms.
*   **COD-Specific Database Model:** A PostgreSQL database schema tailored to capture the nuances of Cash-on-Delivery operations.
*   **Realistic Sample Data Generation:** A Python script using Faker to populate the database with a significant volume of varied and plausible data for demonstration purposes.

## Technologies Used

*   **Backend (Chatbot):** Python, Flask, Flask-CORS
*   **Database:** PostgreSQL
*   **Database Interaction (Python):** psycopg2-binary
*   **Data Generation:** Faker, Python `random` & `datetime`
*   **BI & Dashboarding:** Apache Superset
*   **Natural Language Generation:** Google Gemini API (via `google-generativeai` Python SDK)
*   **Frontend (Chatbot Interface):** HTML, CSS, JavaScript (embedded in Superset)
*   **Configuration Management:** python-dotenv

## Project Structure (Example)
* InsightFlow/ 
* ├── .gitignore
* ├── InsightFlow.py # Main Flask application for the chatbot backend
* ├── generate_data.py # Python script to populate the database
* ├── cod_schema_setup.sql # SQL script to create the database schema
* ├── requirements.txt # Python dependencies
* ├── templates/
* │ └── chat-interface.html # HTML/JS/CSS for the chat UI
* ├── superset_exports/
* │ └── Your_Dashboard_Export.zip # Exported Superset dashboard
* └── README.md
## Setup and Installation Guide

Follow these steps to set up and run the InsightFlow project locally:

**Prerequisites:**

1.  **Git:** [Install Git](https://git-scm.com/downloads)
2.  **Python:** Version 3.9 or higher recommended. [Install Python](https://www.python.org/downloads/) (ensure pip is included).
3.  **PostgreSQL:** Version 12 or higher recommended. [Install PostgreSQL](https://www.postgresql.org/download/) and ensure the server is running. You'll also need a client like `psql` or pgAdmin.
4.  **Apache Superset:** Install and ensure it's running. See [Superset Installation Guide](https://superset.apache.org/docs/installation/installing-superset-from-scratch).
5.  **Google Gemini API Key:** You will need an API key from Google AI Studio or Google Cloud.

**Installation Steps:**

1.  **Clone the Repository:**
    ```bash
    git clone https://github.com/it6adel/InsightFlow.git
    cd InsightFlow
    ```

2.  **Set up Python Virtual Environment:**
    (Navigate into the directory where `InsightFlow.py` and `generate_data.py` are located)
    ```bash
    python -m venv venv
    # Activate it:
    # Windows: .\venv\Scripts\activate
    # MacOS/Linux: source venv/bin/activate
    ```

3.  **Install Python Dependencies:**
    ```bash
    pip install -r requirements.txt
    ```

4.  **Set up PostgreSQL Database:**
    *   Using `psql` or pgAdmin, connect to your PostgreSQL server.
    *   Create a new database. For this project, the name `E-commerce` is used in the scripts:
        ```sql
        CREATE DATABASE "E-commerce";
        ```
    *   Connect to the newly created `E-commerce` database.
    *   Run the schema creation script:
        ```bash
        # If using psql:
        psql -U YOUR_PG_USERNAME -d E-commerce -f cod_schema_setup.sql
        # Enter your PostgreSQL password when prompted.
        # Replace YOUR_PG_USERNAME with your actual PostgreSQL username (e.g., postgres).
        ```
        This will create all the necessary tables, functions, and triggers.

5.  **Configure Environment Variables:**
    *   Create a file named `.env` in the same directory as `InsightFlow.py`.
    *   Add the following, replacing placeholder values with your actual credentials:
        ```dotenv
        # .env
        GEMINI_API_KEY=YOUR_GOOGLE_GEMINI_API_KEY_HERE

        DB_NAME=E-commerce
        DB_USER=YOUR_PG_USERNAME # e.g., postgres
        DB_PASSWORD=YOUR_PG_PASSWORD
        DB_HOST=localhost
        DB_PORT=5432
        ```
    *   **IMPORTANT:** Ensure your PostgreSQL user (`DB_USER`) has privileges to connect to the `E-commerce` database and perform `SELECT`, `INSERT`, `UPDATE`, `DELETE` operations.

6.  **Generate Sample Data:**
    *   Make sure your virtual environment is active.
    *   Run the data generation script:
        ```bash
        python generate_data.py
        ```
        This will populate the tables. Check the terminal for success messages.

7.  **Configure Apache Superset:**
    *   **Connect to Database:**
        1.  In Superset, go to "Data" -> "Databases" -> "+ Database".
        2.  Choose "PostgreSQL".
        3.  Fill in connection details (Hostname: `localhost`, Port: `5432`, Database Name: `E-commerce`, Username: `YOUR_PG_USERNAME`, Password: `YOUR_PG_PASSWORD`).
        4.  Go to the "Advanced" tab, then the "SQL Lab" section. **Uncheck `Allow DDL and DML`**.
        5.  Test the connection and save.
    *   **Import Dashboard:**
        1.  In Superset, go to "Dashboards".
        2.  Click the "Import dashboards" icon (top right).
        3.  Select the `dashboard_export_...zip` file from the `superset_exports/` folder (or wherever you placed it in the repo).
        4.  During import, associate datasets with the "E-commerce" database connection you just created.
    *   **Refresh Datasets (Optional):** Go to "Data" -> "Datasets". Refresh relevant datasets.

8.  **Run the Chatbot Backend:**
    *   Ensure your virtual environment is active.
    *   In your terminal, from the directory containing `InsightFlow.py`, run:
        ```bash
        python InsightFlow.py
        ```
    *   The server should start on `http://localhost:5001`. Keep this terminal window open.

9.  **Access the Dashboard with Embedded Chatbot:**
    *   Open the imported `COD Sales Performance Dashboard` in Superset (usually at `http://localhost:8088`).
    *   The embedded chatbot interface (within an IFrame) should appear. If it shows "Your browser does not support iframes" or is blank:
        *   Ensure the Flask chatbot (`InsightFlow.py`) is running on `http://localhost:5001`.
        *   Ensure both Superset and the Flask app are running on **HTTP** locally. Check the `src` attribute of the `<iframe>` in the dashboard's Markdown component (it should be `http://localhost:5001/chat-interface`).
        *   Check for firewall issues blocking port 5001.

**How to Use the Chatbot:**

1.  View the charts on the Superset dashboard.
2.  Type questions in natural language into the embedded chat interface.
3.  Examples:
    *   `help`
    *   `What was the total delivered revenue last quarter?`
    *   `explain the sales funnel`
    *   `compare failure rate between Algeria and Egypt`
    *   `define aov`
    *   `What can we do about high failures in Algiers?`

## Project Presentation Notes
*   Ensure PostgreSQL service is running.
*   Run `generate_data.py` if the database is empty or needs fresh sample data.
*   Run `InsightFlow.py` to start the chatbot backend.
*   Ensure Superset is running and the dashboard is accessible.
*   Test the embedded chatbot within the Superset dashboard.